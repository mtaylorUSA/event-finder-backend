# Event Finder - Workflow Documentation

Last Updated: 2025-12-06

This document describes the end-to-end workflow for the Event Finder project.

---

## Overview

The Event Finder workflow has 4 main phases:

1. **Organization Discovery** - Finding organizations to scrape
2. **Permission Management** - Getting legal permission to scrape
3. **Event Scraping** - Collecting and enriching event data
4. **Public UI** - End-user event discovery via `event-finder-ui-v7.html`

---

## Phase 1: Organization Discovery

### Automatic Discovery (AI)

1. Run `suggest-organizations.js`
2. AI analyzes existing approved organizations
3. AI suggests similar organizations in national security space
4. New orgs saved with status = `Pending Mission Review`

### Manual Discovery

1. Open PocketBase Admin or `admin-interface.html`
2. Click "Add Organization"
3. Enter organization details
4. Set status = `Pending Mission Review`
5. Save

### Mission Review

1. Open "Pending Review" tab in admin interface
2. For each organization:
   - Review website and mission
   - Check if fits national security focus
   - Check TOU flag (⚠️) if present
3. Decision:
   - ✅ **Approve**: Status → `Mission Approved Pending Permission`
   - ❌ **Reject**: Status → `Mission Rejected`

---

## Phase 2: Permission Management

### Add POC Contacts

For each approved organization:

1. Research POC contact info:
   - Check website footer, "Contact Us" page
   - Look for permissions@, legal@, events@ emails
   - Find staff directory for relevant contacts
2. Add contact via admin interface or `add-contacts.js`
3. Contact types:
   - `Legal/Permissions` - Best for permission requests
   - `Events` - Alternative contact
   - `Media/PR` - Fallback option
   - `Leadership` - Last resort
   - `Other` - General inquiries

### Generate Permission Request Drafts

1. Run `generate-permission-requests.js`
2. Script automatically:
   - Pulls your info from `settings` collection
   - Finds best contact for each org (Legal/Permissions > Events > Other)
   - Generates customized email draft
   - Saves to `permission_request_draft` field

### Review and Send Permission Requests

1. Open PocketBase Admin
2. Go to organizations collection
3. Filter by status = `Mission Approved Pending Permission`
4. For each organization:
   - Open record
   - Review `permission_request_draft` field
   - Copy draft to email client
   - Edit if needed
   - Send email
5. After sending:
   - Update status → `Permission Requested (Self)` or `Permission Requested (Lawyer)`
   - Set `permission_requested_date` to today

### Handle Responses

**If Permission Granted:**
1. Paste approval email into `permission_correspondence` field
2. Update status → `Permission Granted`
3. Set `permission_response_date` to today
4. Set `scraping_enabled` = true
5. Update status → `Scraping Active`

**If Permission Rejected:**
1. Paste rejection email into `permission_correspondence` field
2. Update status → `Permission Rejected`
3. Set `permission_response_date` to today

**If No Response (after 2 weeks):**
1. Send follow-up email
2. Add note to `permission_correspondence` field

---

## Phase 3: Event Scraping

### Enable Scraping

Prerequisites:
- Status = `Permission Granted` or `Scraping Active`
- `scraping_enabled` = true
- `events_url` is set

### Run Scrapers

**Option A: Scrape All Enabled Organizations**
```powershell
node scrape-all-organizations.js
```

**Option B: Scrape Specific Organization**
```powershell
node scrape-cfr-events.js
node scrape-cisa-events.js
node scrape-insa-events.js
```

### Scraper Behavior

1. Fetches events page from `events_url`
2. Parses event data (title, date, time, location, URL)
3. Checks for duplicates by `source_id`
4. Saves new events to `events` collection
5. Updates `last_scraped` timestamp on organization

### Enrich Events (Optional)

After scraping, run AI enrichment:
```powershell
node enrich-events.js
```

This adds:
- Topic tags
- Event type classification
- Speaker extraction

### Generate Embeddings (Optional)

For semantic search:
```powershell
node generate-embeddings.js
```

This creates vector embeddings for event search.

### After Scraping: Verify in Public UI

1. Open `event-finder-ui-v7.html` in browser
2. Refresh the page to load new data from PocketBase
3. Verify new events appear correctly
4. Check that dates, locations, and descriptions display properly

---

## Phase 4: Public UI

The public-facing interface (`event-finder-ui-v7.html`) allows users to discover events.

### Accessing the UI

1. Open `event-finder-ui-v7.html` in any browser
2. UI automatically fetches data from PocketBase API
3. No login required for viewing events

### UI Features

| Feature | Description |
|---------|-------------|
| **Search** | Searches event title and description only |
| **Date Filter** | Start date defaults to today; end date optional |
| **Format Filter** | Virtual / In-Person checkboxes |
| **More Filters** | Topics, Regions, Organizations |
| **List View** | Event cards with details |
| **Calendar View** | Monthly calendar display |

### How Data Flows to the UI

```
PocketBase Database
        ↓
    API Request
        ↓
event-finder-ui-v7.html
        ↓
   User sees events
```

### What Users See on Event Cards

| Field | Display |
|-------|---------|
| Title | Event name |
| Description | 2 lines max |
| Dates | Full month format (e.g., "December 18, 2025") |
| Organization | Name with link to website |
| Location | City, ST or "Virtual" or "Hybrid" |
| Link | "More details and registration" |

### Date Display Formats

| Scenario | Display |
|----------|---------|
| Single day | December 18, 2025 |
| Multi-day, same month | December 9-10, 2025 |
| Different months | December 30, 2025 to January 2, 2026 |

### Search Behavior

- Searches **title** and **description** only
- Does NOT search organization name, topics, or location
- Short terms (≤3 chars like "AI") use word boundary matching

### Updating Event Data for the UI

To update how an event appears in the public UI:

1. Open PocketBase Admin
2. Click on `events` collection
3. Find and click on the event
4. Update fields:
   - `description` - What users see (2 lines max)
   - `start_date` / `end_date` - For date display
   - `location` - City, ST format preferred
5. Click "Save"
6. Refresh `event-finder-ui-v7.html` to see changes

---

## Maintenance Tasks

### Cleanup Orphaned Events

Remove events whose organization was deleted:
```powershell
node cleanup-orphaned-events.js
```

### Cleanup Bad Events

Remove events with missing required fields:
```powershell
node cleanup-bad-events.js
```

---

## Status Reference

| Status | Can Edit? | Can Scrape? | Shows in UI? | Next Action |
|--------|-----------|-------------|--------------|-------------|
| Pending Mission Review | Yes | No | No | Review and approve/reject |
| Mission Approved Pending Permission | Yes | No | No | Send permission request |
| Mission Rejected | Yes | No | No | None (end state) |
| Permission Requested (Self) | Yes | No | No | Wait for response |
| Permission Requested (Lawyer) | Yes | No | No | Wait for response |
| Permission Granted | Yes | Yes | Yes* | Enable scraping |
| Permission Rejected | Yes | No | No | None (end state) |
| Scraping Active | Yes | Yes | Yes | Monitor and maintain |

*Events from approved organizations appear in the public UI after scraping.

---

## Quick Reference: Common Tasks

### Add a New Organization
1. Admin interface → "Add Organization"
2. Fill in details, set status = `Pending Mission Review`
3. Save

### Approve an Organization
1. Admin interface → "Pending Review" tab
2. Click "✅ Approve Mission"
3. Status changes to `Mission Approved Pending Permission`

### Send Permission Request
1. Run `generate-permission-requests.js`
2. Open org in PocketBase
3. Copy `permission_request_draft`
4. Send email
5. Update status to `Permission Requested (Self)`

### Enable Scraping After Approval
1. Open org in PocketBase
2. Set `scraping_enabled` = true
3. Set status = `Scraping Active`
4. Run `node scrape-all-organizations.js`
5. Refresh `event-finder-ui-v7.html` to verify events appear

### Check Scraping Results
1. Admin interface → "Events" tab
2. Filter by organization
3. Review scraped events
4. Open `event-finder-ui-v7.html` to verify public display

### Update an Event's Public Display
1. Open PocketBase Admin → `events` collection
2. Click on the event to edit
3. Update `description`, `start_date`, `end_date`, or `location`
4. Click "Save"
5. Refresh `event-finder-ui-v7.html` to see changes

---

## Workflow Diagram

```
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   ┌─────────────┐     ┌─────────────────────┐     ┌─────────────────┐   │
│   │ AI Suggests │────▶│ Pending Mission     │────▶│ Mission         │   │
│   │ Organization│     │ Review              │     │ Rejected        │   │
│   └─────────────┘     └──────────┬──────────┘     └─────────────────┘   │
│                                  │                                       │
│                                  ▼                                       │
│                       ┌─────────────────────┐                           │
│                       │ Mission Approved    │                           │
│                       │ Pending Permission  │                           │
│                       └──────────┬──────────┘                           │
│                                  │                                       │
│                                  ▼                                       │
│                       ┌─────────────────────┐     ┌─────────────────┐   │
│                       │ Permission          │────▶│ Permission      │   │
│                       │ Requested           │     │ Rejected        │   │
│                       └──────────┬──────────┘     └─────────────────┘   │
│                                  │                                       │
│                                  ▼                                       │
│                       ┌─────────────────────┐                           │
│                       │ Permission          │                           │
│                       │ Granted             │                           │
│                       └──────────┬──────────┘                           │
│                                  │                                       │
│                                  ▼                                       │
│                       ┌─────────────────────┐                           │
│                       │ Scraping            │◀──┐                       │
│                       │ Active              │───┘ (recurring)           │
│                       └──────────┬──────────┘                           │
│                                  │                                       │
│                                  ▼                                       │
│                       ┌─────────────────────┐                           │
│                       │ Public UI           │                           │
│                       │ (event-finder-ui-v7)│                           │
│                       └─────────────────────┘                           │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## Related Documentation

- `PocketBase-UI-Reference.md` - How to use PocketBase admin
- `PocketBase-Schema.md` - Database field details (includes UI display notes)
- `Running-Scripts.md` - How to execute scripts
- `Event-Finder-Context.md` - Project overview
- `event-finder-ui-v7.html` - Public-facing event search interface
