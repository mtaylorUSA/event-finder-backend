# Event Finder - Approval & Scraping Workflow

**Last Updated:** 2025-12-01

## Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ORGANIZATION PIPELINE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ AI Suggests  â”‚â”€â”€â”€â–¶â”‚   Mission    â”‚â”€â”€â”€â–¶â”‚  Permission  â”‚â”€â”€â”€â–¶â”‚  Active   â”‚ â”‚
â”‚  â”‚ Organization â”‚    â”‚   Approval   â”‚    â”‚   Approval   â”‚    â”‚  Scraping â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                   â”‚                   â”‚                          â”‚
â”‚         â–¼                   â–¼                   â–¼                          â”‚
â”‚   - Dedupe check       - Approved or       - POC moved to                  â”‚
â”‚   - TOU flagged        - Rejected            `contacts`                    â”‚
â”‚     if issue                                - Permission tracked           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Stage 1: AI Suggests Organizations

**What happens:**

1. AI analyzes existing organizations and events in database
2. AI checks for duplicates across ALL 3 collections:
   - `organizations` (already approved)
   - `suggested_organizations` (already pending)
   - `rejected_organizations` (already rejected)
3. If not a duplicate, AI suggests up to 20 similar national security/defense organizations
4. For each suggestion, AI gathers **publicly available info only** (no event scraping):
   - Organization name, website, mission/description
   - Organization type (`org_type`)
   - POC / contact info (temporary â€” will move to `contacts` later)
   - TOU/User Agreement (to check for scraping prohibitions)

**âš ï¸ IMPORTANT:** No events are scraped at this stage. Event scraping only begins after permission is granted.

**TOU Check Result:**

- âš ï¸ If TOU may prohibit scraping â†’ Set `tou_flag = true` and add details to `tou_notes`
- This is a **warning**, not an automatic rejection
- Admin still reviews and makes final decision

**Where stored:** `suggested_organizations` collection

**Key Fields Set:**

| Field | Value |
|-------|-------|
| `status` | `Pending` |
| `suggested_date` | Current date/time |
| `similarity_score` | AI confidence (0-100) |
| `tou_flag` | `true` if TOU concerns, `false` otherwise |

---

## Stage 2: Mission Approval (Admin Review)

**What happens:**

1. Admin reviews suggested organizations in Admin Interface
2. Admin sees TOU flags highlighted for attention
3. Admin determines if org fits the project mission
4. Admin marks each org as approved or rejected

**How to do it:**

1. Open `admin-interface.html`
2. Login
3. Navigate to Discover/Add Orgs
4. Review (note any TOU flags) and Approve/Reject

**Outcome:**

| Decision | Action |
|----------|--------|
| âœ… Approved | Set `status = Mission Approved`, proceed to Permission stage |
| âŒ Rejected | Move to `rejected_organizations` with `rejection_reason = Mission Mismatch` |

---

## Stage 2.5: Create Contact Records (New Step)

**What happens:**

When an organization is approved, admin creates contact record(s) in the `contacts` collection.

**How to do it:**

1. Open PocketBase Admin â†’ `contacts` collection
2. Click "+ New record"
3. Fill in fields:
   - `name` â€” POC name from suggested org
   - `email` â€” POC email from suggested org
   - `title` â€” POC title from suggested org
   - `organization` â€” Select the approved organization
   - `contact_type` â€” Select appropriate type (e.g., `Legal/Permissions`)
4. Click "Save"

**Why this step exists:**

- Centralizes all contact data in one collection
- Supports multiple contacts per organization
- Separates temporary (suggested) data from permanent (approved) data

**Contact Types Available:**

- `Leadership` â€” CEO, President, Director
- `Events` â€” Events coordinator, calendar manager
- `Legal/Permissions` â€” Who approves scraping
- `Media/PR` â€” Press contacts
- `Other` â€” Catch-all

---

## Stage 3: Permission Approval (Legal/Compliance)

**Permission Status Color Codes:**

| Status | Color | Meaning |
|--------|-------|---------|
| ğŸŸ¡ Not Yet Requested | Yellow | Admin hasn't contacted org yet |
| ğŸ”µ Permission Pending | Blue | Request sent, awaiting response |
| ğŸŸ¢ Permission Granted | Green | Org approved scraping |
| ğŸ”´ Permission Rejected | Red | Org denied scraping |

**Permission Status Values in PocketBase:**

- `Not Yet Requested (Self)`
- `Not Yet Requested (Lawyer)`
- `Permission Pending (Requested by Self)`
- `Permission Pending (Requested by Lawyer)`
- `Permission Granted (Requested by Self)`
- `Permission Granted (Requested by Lawyer)`
- `Permission Rejected (Requested by Self)`
- `Permission Rejected (Requested by Lawyer)`

**Who requests permission:**

- **Phase 1 (Personal Use):** Admin contacts org POCs directly
- **Later Phases (Commercial):** Lawyer contacts org POCs

**What happens:**

1. Admin/Lawyer contacts organization POCs (from `contacts` collection)
2. Request permission to scrape public event data
3. Track response in PocketBase:
   - Set `permission_status`
   - Set `permission_requested_date`
   - Set `permission_requested_by` (Admin or Lawyer)
   - Set `permission_response_date` when response received
   - Upload `permission_document` if applicable
4. Document any permission terms or conditions in `notes`

**Outcome:**

| Decision | Action |
|----------|--------|
| ğŸŸ¢ Granted | Set `scraping_enabled = true`, add `events_url` |
| ğŸ”´ Rejected | Move to `rejected_organizations` with `rejection_reason = Permission Denied` |

---

## Stage 4: Active Scraping

**What happens (when enabled):**

1. Daily automated scraping via GitHub Actions (8 AM EST)
2. `scrape-all-organizations.js` processes all orgs where `scraping_enabled = true`
3. For each org:
   - Fetch events from `events_url`
   - Check `source_id` for duplicates
   - Save new events to `events` collection
   - 2-second delay before next org (polite scraping)
4. Generate embeddings for new events (semantic search)
5. Update `last_scraped` timestamp on organization

**Current Status:** â›” ALL SCRAPING DISABLED (awaiting permissions)

---

## Stage 5: AI Tagging (Post-Scrape)

**What happens:**

After events are scraped, they can be tagged with topics and regions using AI.

**How to do it:**

1. Run `node enrich-events.js`
2. Script sends each event's title + description to GPT-4o-mini
3. AI returns matching topics and regions
4. Script validates against allowed values
5. Updates event records in PocketBase

**Topics (13 categories):**
- AI & Emerging Tech, Careers & Professional Development, Climate & Security, Counterterrorism, Cybersecurity, Defense Policy, Diplomacy & Statecraft, Economic Security, Homeland Security, Intelligence, Military Operations, Nuclear/WMD, Space & Satellites

**Regions (10 categories):**
- Africa, Arctic, China, Domestic US, Europe/NATO, Global/Multilateral, Indo-Pacific, Latin America, Middle East, Russia

---

## Rejection Paths Summary

| Rejection Reason | When It Happens | Action |
|------------------|-----------------|--------|
| `Duplicate` | AI suggestion (Stage 1) | Skip â€” don't save to `suggested_organizations` |
| `TOU Prohibits` | Admin review (Stage 2) | Move to `rejected_organizations` |
| `Mission Mismatch` | Admin review (Stage 2) | Move to `rejected_organizations` |
| `Permission Denied` | After request (Stage 3) | Move to `rejected_organizations` |
| `Other` | Any stage | Move to `rejected_organizations` |

---

## Data Flow: POC Information

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ suggested_organizations â”‚
â”‚   - poc_name            â”‚  â† AI gathers (temporary)
â”‚   - poc_email           â”‚
â”‚   - poc_title           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ Admin approves & creates contact
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       contacts          â”‚
â”‚   - name                â”‚  â† Permanent storage
â”‚   - email               â”‚
â”‚   - title               â”‚
â”‚   - organization (rel)  â”‚  â† Links to organizations
â”‚   - contact_type        â”‚
â”‚   - last_verified       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference: Where Things Happen

| Action | Location |
|--------|----------|
| Review suggested orgs | Admin Interface |
| See TOU flags | Admin Interface (highlighted) |
| Mission approve/reject | Admin Interface â†’ PocketBase |
| Create contact records | PocketBase Admin â†’ `contacts` |
| Track permission status | PocketBase Admin â†’ `organizations` |
| Upload permission docs | PocketBase Admin â†’ `organizations` â†’ `permission_document` |
| Send permission requests | Manual email to contacts |
| Enable/disable scrapers | PocketBase â†’ `organizations` â†’ `scraping_enabled` |
| View scraped events | PocketBase Admin â†’ `events` |
| View event embeddings | PocketBase Admin â†’ `event_embeddings` |
| Run AI tagging | PowerShell â†’ `node enrich-events.js` |
| View user interface | Browser â†’ `http://localhost:8080/event-finder-ui-v3.html` |

---

## Scraper Types

### Basic Scrapers (Level 1)
- Only scrape event list page
- Get: title, URL, date (limited info)
- Missing: full description, complete location
- Examples: `scrape-cisa-events.js`, `scrape-insa-events.js`

### Deep Scrapers (Level 2)
- Scrape event list page for URLs
- Visit each event page for full details
- Get: title, URL, date, full description, location, time
- Example: `scrape-cfr-events.js`

---

## Key Database Fields Reference

### `suggested_organizations` â€” Status Values

```
Pending, Mission Approved, Mission Rejected
```

### `rejected_organizations` â€” Rejection Reasons

```
Mission Mismatch, Permission Denied, TOU Prohibits, Duplicate, Other
```

### `organizations` â€” Permission Status Values

```
Not Yet Requested (Self), Not Yet Requested (Lawyer), Permission Pending (Requested by Self), Permission Pending (Requested by Lawyer), Permission Granted (Requested by Self), Permission Granted (Requested by Lawyer), Permission Rejected (Requested by Self), Permission Rejected (Requested by Lawyer)
```

### `organizations` â€” Terms Status Values

```
Not Indicated, Scraping OK, Scraping Prohibited
```

### `contacts` â€” Contact Types

```
Leadership, Events, Legal/Permissions, Media/PR, Other
```

### `events` â€” Topics Values

```
AI & Emerging Tech, Careers & Professional Development, Climate & Security, Counterterrorism, Cybersecurity, Defense Policy, Diplomacy & Statecraft, Economic Security, Homeland Security, Intelligence, Military Operations, Nuclear/WMD, Space & Satellites
```

### `events` â€” Regions Values

```
Africa, Arctic, China, Domestic US, Europe/NATO, Global/Multilateral, Indo-Pacific, Latin America, Middle East, Russia
```
