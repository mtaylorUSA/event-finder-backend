# Event Finder - Approval & Scraping Workflow

**Last Updated:** 2025-12-03
**Version:** 2.0 (Streamlined)

---

## What Changed in v2.0

| Before | After |
|--------|-------|
| 3 org collections (`suggested`, `organizations`, `rejected`) | 1 collection (`organizations`) with `status` field |
| Manual POC research | AI auto-gathers POC from website |
| Manual permission letter drafting | Auto-generated permission request |
| Manual contact creation | AI creates contacts automatically |

---

## Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ORGANIZATION DISCOVERY & APPROVAL PIPELINE                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AI Discovers â”‚â”€â”€â”€â–¶â”‚  AI Gathers  â”‚â”€â”€â”€â–¶â”‚   Admin      â”‚â”€â”€â”€â–¶â”‚  Active   â”‚  â”‚
â”‚  â”‚   New Org    â”‚    â”‚ Website Info â”‚    â”‚   Review     â”‚    â”‚  Scraping â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚                           â”‚
â”‚         â–¼                   â–¼                   â–¼                           â”‚
â”‚   - Embedding match    - POC/contacts      - Mission check                  â”‚
â”‚   - Dedupe by domain   - TOU check         - Permission request             â”‚
â”‚   - Create org record  - Events URL        - Enable scraping                â”‚
â”‚                        - Create contacts                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Stage 1: AI Discovers New Organizations

**What happens:**

1. AI analyzes existing organizations and events using embeddings
2. AI identifies similar national security/defense organizations
3. AI checks for duplicates using `source_id` (website domain)
4. If not a duplicate, AI proceeds to gather website info

**Deduplication:**
- Uses website domain as unique identifier (e.g., `csis.org`)
- Checks `organizations` collection for existing `source_id`
- Skips if already exists

**Script:** `discover-organizations.js`

---

## Stage 2: AI Gathers Website Info

**What happens:**

For each new organization, AI visits the website and gathers:

| Info | Where Stored | Notes |
|------|--------------|-------|
| Organization name | `organizations.name` | |
| Website URL | `organizations.website` | |
| Mission/description | `organizations.description` | |
| Organization type | `organizations.org_type` | Think tank, Gov agency, etc. |
| Events page URL | `organizations.events_url` | For future scraping |
| TOU concerns | `organizations.tou_flag` | Boolean |
| TOU details | `organizations.tou_notes` | Text explanation |
| POC name | `contacts.name` | Creates contact record |
| POC email | `contacts.email` | Creates contact record |
| POC title | `contacts.title` | Creates contact record |

**âš ï¸ IMPORTANT:** 
- This is NOT scraping â€” it's reading publicly available contact/about pages
- No event data is extracted at this stage
- Event scraping only begins after permission is granted

**TOU Check:**
- âš ï¸ If TOU may prohibit scraping â†’ Set `tou_flag = true`
- Add details to `tou_notes`
- This is a **warning**, not an automatic rejection
- Admin makes final decision

**Records Created:**

1. **Organization record** with:
   - `status` = `Pending Mission Review`
   - `source_id` = website domain
   - `discovered_date` = current timestamp
   - All gathered info

2. **Contact record(s)** linked to the organization

---

## Stage 3: Admin Mission Review

**Status:** `Pending Mission Review`

**What admin sees:**
- New organizations awaiting review
- TOU flags highlighted âš ï¸
- AI reasoning for suggestion
- Similarity score

**Admin actions:**

| Decision | New Status | What Happens |
|----------|------------|--------------|
| âœ… Approve | `Mission Approved, Pending Permission` | Auto-generates permission request draft |
| âŒ Reject | `Mission Rejected` | Org stays in database with rejected status |

**How to do it:**
1. Open Admin Interface or PocketBase Admin
2. Filter organizations by `status = Pending Mission Review`
3. Review each org (note TOU flags)
4. Set status to approved or rejected

---

## Stage 4: Permission Request (Auto-Generated)

**Status:** `Mission Approved, Pending Permission`

**What happens automatically:**

When status changes to `Mission Approved, Pending Permission`:
1. System pulls POC info from linked `contacts` record
2. System pulls owner info from `settings` collection
3. System generates permission request in `permission_request_draft` field

**Auto-Generated Email Template:**

```
Subject: Permission Request - Event Data Aggregation 

Dear [POC_NAME], 

I am developing a research tool to aggregate publicly available event 
information from national security and foreign policy organizations. 
I am writing to request permission to: 
- Programmatically access your public events list page and/or 
  individual events' pages;
- Extract basic event information (title, date, time, location, URL); 
- Store this information in a personal database; 
- Display event titles with links back to your original event pages. 

I want to emphasize: 
- This is currently a personal/research project, intended for me 
  and a small number of users;
- All events would link back to your website for registration;
- No content beyond basic event metadata would be reproduced;
- I would respect any rate limits or technical restrictions;
- I would immediately cease if requested.

I have reviewed your website's terms of use and wanted to explicitly 
request permission rather than make assumptions. 

Would you be willing to grant permission for this use? 

Thank you for your consideration. 

Regards, 
[MY_NAME] 
[MY_EMAIL]
[MY_MOBILE]
```

**Admin actions:**
1. Review/edit the draft in `permission_request_draft` field
2. Copy and send via email to POC
3. Update status to `Permission Requested (Self)` or `Permission Requested (Lawyer)`
4. Set `permission_request_date`

---

## Stage 5: Awaiting Permission Response

**Status:** `Permission Requested (Self)` or `Permission Requested (Lawyer)`

**Tracking:**
- `permission_request_date` â€” when request was sent
- Check email for responses

**When response received:**

| Response | New Status | Actions |
|----------|------------|---------|
| âœ… Approved | `Permission Granted` | Set `permission_response_date`, paste approval in `permission_correspondence` |
| âŒ Denied | `Permission Rejected` | Set `permission_response_date`, note reason |
| ğŸ“‹ Conditions | `Permission Granted` | Document conditions in `notes` |

---

## Stage 6: Enable Scraping

**Status:** `Permission Granted`

**Admin actions:**
1. Verify `events_url` is correct
2. Set `scraping_enabled = true`
3. Update status to `Scraping Active`

**What happens next:**
- Organization is included in daily scraping runs
- Events are extracted and saved to `events` collection
- `last_scraped` timestamp is updated

---

## Stage 7: Active Scraping

**Status:** `Scraping Active`

**Automated process:**
1. Daily scraping via GitHub Actions (8 AM EST) or manual run
2. `scrape-all-organizations.js` processes orgs where `scraping_enabled = true`
3. For each org:
   - Fetch events from `events_url`
   - Check `source_id` for duplicates
   - Save new events to `events` collection
   - 2-second delay between orgs (polite scraping)
4. Generate embeddings for new events
5. Update `last_scraped` timestamp

**Current Status:** â›” ALL SCRAPING DISABLED (awaiting permissions)

---

## Stage 8: AI Tagging (Post-Scrape)

**What happens:**

After events are scraped, AI tags them with topics and regions.

**How to do it:**
1. Run `node enrich-events.js`
2. Script sends event title + description to GPT-4o-mini
3. AI returns matching topics and regions
4. Script validates against allowed values
5. Updates event records in PocketBase

**Topics (13 categories):**
- AI & Emerging Tech, Careers & Professional Development, Climate & Security, Counterterrorism, Cybersecurity, Defense Policy, Diplomacy & Statecraft, Economic Security, Homeland Security, Intelligence, Military Operations, Nuclear/WMD, Space & Satellites

**Regions (10 categories):**
- Africa, Arctic, China, Domestic US, Europe/NATO, Global/Multilateral, Indo-Pacific, Latin America, Middle East, Russia

---

## Organization Status Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pending Mission Review   â”‚ â† AI just discovered
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
       â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mission    â”‚ â”‚ Mission Approved,              â”‚
â”‚  Rejected   â”‚ â”‚ Pending Permission             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â€¢ Auto-generates request draft â”‚
    (END)       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Permission Requested    â”‚   â”‚ Permission Requested    â”‚
â”‚ (Self)                  â”‚   â”‚ (Lawyer)                â”‚
â”‚ â€¢ Request date tracked  â”‚   â”‚ â€¢ Request date tracked  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Permission Granted    â”‚ â”‚   Permission Rejected   â”‚
â”‚ â€¢ Response date         â”‚ â”‚ â€¢ Response date         â”‚
â”‚ â€¢ Paste correspondence  â”‚ â”‚   (END - Do Not Scrape) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Scraping Active     â”‚ â† Admin sets scraping_enabled = true
â”‚ â€¢ last_scraped updated  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Status Color Codes (for Admin Interface)

| Status | Color | Meaning |
|--------|-------|---------|
| ğŸŸ£ Pending Mission Review | Purple | New, needs review |
| ğŸŸ¢ Mission Approved, Pending Permission | Green | Ready for outreach |
| âš« Mission Rejected | Gray | Does not fit mission |
| ğŸ”µ Permission Requested (Self) | Blue | Awaiting response |
| ğŸ”µ Permission Requested (Lawyer) | Blue | Awaiting response |
| ğŸŸ¢ Permission Granted | Green | Ready to enable |
| ğŸ”´ Permission Rejected | Red | Cannot scrape |
| âœ… Scraping Active | Green+Check | Currently scraping |

---

## Key Database Fields Reference

### `organizations.status` Values

```
Pending Mission Review
Mission Approved, Pending Permission
Mission Rejected
Permission Requested (Self)
Permission Requested (Lawyer)
Permission Granted
Permission Rejected
Scraping Active
```

### `contacts.contact_type` Values

```
Leadership, Events, Legal/Permissions, Media/PR, Other
```

### `events.topics` Values

```
AI & Emerging Tech, Careers & Professional Development, Climate & Security, Counterterrorism, Cybersecurity, Defense Policy, Diplomacy & Statecraft, Economic Security, Homeland Security, Intelligence, Military Operations, Nuclear/WMD, Space & Satellites
```

### `events.regions` Values

```
Africa, Arctic, China, Domestic US, Europe/NATO, Global/Multilateral, Indo-Pacific, Latin America, Middle East, Russia
```

---

## Quick Reference: Where Things Happen

| Action | Location |
|--------|----------|
| Discover new organizations | Run `node discover-organizations.js` |
| Review pending organizations | Admin Interface / PocketBase |
| See TOU flags | Admin Interface (highlighted) |
| Mission approve/reject | Change `status` field |
| View/edit permission request draft | `organizations.permission_request_draft` |
| Send permission request | Copy draft, email to POC |
| Track permission status | Change `status` field |
| Paste permission approval | `organizations.permission_correspondence` |
| Enable scraping | Set `scraping_enabled = true` |
| Run scrapers | Run `node scrape-all-organizations.js` |
| Run AI tagging | Run `node enrich-events.js` |
| View events | PocketBase Admin â†’ `events` |
| View user interface | `http://localhost:8080/event-finder-ui-v3.html` |

---

## Scraper Types

### Basic Scrapers (Level 1)
- Only scrape event list page
- Get: title, URL, date (limited info)
- Missing: full description, complete location

### Deep Scrapers (Level 2)
- Scrape event list page for URLs
- Visit each event page for full details
- Get: title, URL, date, full description, location, time

---

## Collections Overview (v2.0)

| Collection | Purpose | Notes |
|------------|---------|-------|
| `settings` | Owner info for emails | NEW - 1 record |
| `organizations` | All orgs (all statuses) | UPDATED - single source of truth |
| `contacts` | POCs for organizations | Unchanged |
| `events` | Scraped event data | Unchanged |
| `event_embeddings` | AI search vectors | Unchanged |
| `users` | User accounts | Unchanged |

### Removed Collections
- ~~`suggested_organizations`~~ â†’ Merged into `organizations`
- ~~`rejected_organizations`~~ â†’ Merged into `organizations`
