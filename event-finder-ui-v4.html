<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Finder - National Security Events</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --accent: #0891b2;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --dark: #1e293b;
            --darker: #0f172a;
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --sidebar-width: 280px;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--gray-100);
            color: var(--dark);
            min-height: 100vh;
        }

        /* ============================================
           HEADER
           ============================================ */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-brand h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
        }

        .header-stats {
            display: flex;
            gap: 20px;
        }

        .header-stat {
            text-align: center;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .header-stat:hover {
            background: var(--gray-100);
        }

        .header-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .header-stat-label {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ============================================
           MAIN LAYOUT - Sidebar + Content
           ============================================ */
        .main-layout {
            display: flex;
            min-height: calc(100vh - 60px);
        }

        /* ============================================
           LEFT SIDEBAR
           ============================================ */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            padding: 20px;
            position: sticky;
            top: 60px;
            height: calc(100vh - 60px);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Location Filter */
        .location-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .location-row span {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .radius-select {
            padding: 6px 10px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--white);
            cursor: pointer;
            min-width: 70px;
        }

        .radius-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .zip-input {
            padding: 6px 10px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.9rem;
            width: 80px;
        }

        .zip-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .use-location {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--gray-600);
            cursor: pointer;
            margin-top: 4px;
        }

        .use-location input {
            cursor: pointer;
        }

        /* Date Range */
        .date-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .date-row label {
            font-size: 0.9rem;
            color: var(--gray-600);
            min-width: 40px;
        }

        .date-input {
            padding: 6px 10px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.9rem;
            flex: 1;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        /* More Filters Button */
        .more-filters-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 10px 14px;
            background: var(--gray-50);
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-700);
            transition: all 0.2s;
        }

        .more-filters-btn:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .more-filters-btn.has-filters {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary-dark);
        }

        .filter-count-badge {
            background: var(--primary);
            color: var(--white);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }

        /* Active Filters Display */
        .active-filters-sidebar {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-200);
        }

        .active-filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--primary-light);
            color: var(--primary-dark);
            border-radius: 4px;
            font-size: 0.75rem;
            margin: 0 4px 4px 0;
        }

        .active-filter-tag button {
            background: none;
            border: none;
            color: var(--primary-dark);
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            padding: 0;
            opacity: 0.7;
        }

        .active-filter-tag button:hover {
            opacity: 1;
        }

        .clear-filters-btn {
            display: block;
            margin-top: 8px;
            padding: 6px 12px;
            background: none;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s;
        }

        .clear-filters-btn:hover {
            background: var(--gray-100);
        }

        /* ============================================
           MAIN CONTENT AREA
           ============================================ */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 900px;
        }

        /* Search Box */
        .search-container {
            margin-bottom: 20px;
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--white);
            transition: all 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .search-box-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.1rem;
            color: var(--gray-400);
        }

        /* Results Info */
        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 0 4px;
        }

        .results-count {
            font-size: 0.9rem;
            color: var(--gray-500);
        }

        .results-count strong {
            color: var(--dark);
        }

        .view-toggle {
            display: flex;
            gap: 4px;
        }

        .view-toggle button {
            padding: 6px 12px;
            border: 1px solid var(--gray-300);
            background: var(--white);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .view-toggle button:first-child {
            border-radius: 6px 0 0 6px;
        }

        .view-toggle button:last-child {
            border-radius: 0 6px 6px 0;
            border-left: none;
        }

        .view-toggle button.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--white);
        }

        /* ============================================
           EVENT CARDS - New Layout
           ============================================ */
        .events-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .event-card {
            display: flex;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .event-card:hover {
            border-color: var(--gray-300);
            box-shadow: var(--shadow-md);
        }

        .event-card-image {
            width: 100px;
            min-height: 120px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border-right: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        /* Topic-based backgrounds */
        .event-card-image.cybersecurity { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .event-card-image.defense-policy { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .event-card-image.intelligence { background: linear-gradient(135deg, #1e293b 0%, #475569 100%); }
        .event-card-image.nuclear-wmd { background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%); }
        .event-card-image.space-satellites { background: linear-gradient(135deg, #0f172a 0%, #6366f1 100%); }
        .event-card-image.ai-emerging-tech { background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%); }
        .event-card-image.counterterrorism { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
        .event-card-image.military-operations { background: linear-gradient(135deg, #065f46 0%, #047857 100%); }
        .event-card-image.homeland-security { background: linear-gradient(135deg, #1e40af 0%, #3730a3 100%); }
        .event-card-image.climate-security { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .event-card-image.economic-security { background: linear-gradient(135deg, #ca8a04 0%, #eab308 100%); }
        .event-card-image.diplomacy-statecraft { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }
        .event-card-image.careers { background: linear-gradient(135deg, #64748b 0%, #94a3b8 100%); }
        .event-card-image.default { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }

        .event-card-content {
            flex: 1;
            padding: 14px 16px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .event-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.3;
            margin-bottom: 2px;
        }

        .event-detail {
            display: flex;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .event-detail-label {
            font-weight: 600;
            color: var(--gray-600);
            min-width: 95px;
            flex-shrink: 0;
        }

        .event-detail-value {
            color: var(--gray-700);
        }

        .event-detail-value a {
            color: var(--primary);
            text-decoration: none;
        }

        .event-detail-value a:hover {
            text-decoration: underline;
        }

        .event-register-link {
            display: inline-block;
            margin-top: 6px;
            padding: 6px 14px;
            background: var(--primary);
            color: var(--white);
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            transition: background 0.2s;
            align-self: flex-start;
        }

        .event-register-link:hover {
            background: var(--primary-dark);
        }

        /* ============================================
           CALENDAR VIEW
           ============================================ */
        .calendar-container {
            display: none;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-container.active {
            display: block;
        }

        .events-list.hidden {
            display: none;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav-btn {
            background: var(--white);
            border: 1px solid var(--gray-300);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .calendar-nav-btn:hover {
            background: var(--gray-100);
        }

        .calendar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day-header {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--gray-500);
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }

        .calendar-day {
            min-height: 90px;
            padding: 6px;
            border-right: 1px solid var(--gray-100);
            border-bottom: 1px solid var(--gray-100);
            background: var(--white);
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day.other-month {
            background: var(--gray-50);
        }

        .calendar-day.today {
            background: var(--primary-light);
        }

        .calendar-date {
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--gray-400);
            margin-bottom: 4px;
        }

        .calendar-day.today .calendar-date {
            background: var(--primary);
            color: var(--white);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-event {
            padding: 2px 4px;
            margin-bottom: 2px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .calendar-event:hover {
            background: var(--primary);
            color: var(--white);
        }

        .calendar-more {
            font-size: 0.7rem;
            color: var(--gray-500);
            padding: 2px 4px;
        }

        /* ============================================
           FILTER MODAL
           ============================================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-400);
            cursor: pointer;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--gray-600);
        }

        .modal-body {
            padding: 20px;
            max-height: calc(85vh - 140px);
            overflow-y: auto;
        }

        .modal-section {
            margin-bottom: 24px;
        }

        .modal-section:last-child {
            margin-bottom: 0;
        }

        .modal-section-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checkbox-item:hover {
            background: var(--gray-100);
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: var(--white);
            border: 1px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-100);
        }

        .btn-primary {
            background: var(--primary);
            border: 1px solid var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        /* ============================================
           ORGANIZATIONS MODAL
           ============================================ */
        .org-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: var(--gray-50);
            transition: all 0.2s;
        }

        .org-item:hover {
            background: var(--gray-100);
        }

        .org-item:last-child {
            margin-bottom: 0;
        }

        .org-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .org-info {
            flex: 1;
        }

        .org-name {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .org-name a {
            color: inherit;
            text-decoration: none;
        }

        .org-name a:hover {
            color: var(--primary);
        }

        .org-type {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .org-event-count {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
        }

        /* ============================================
           EMPTY STATE
           ============================================ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-400);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 1.1rem;
            color: var(--gray-600);
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 0.9rem;
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--gray-200);
                padding: 16px;
            }

            .filter-section {
                margin-bottom: 16px;
            }

            .main-content {
                max-width: 100%;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .header {
                flex-direction: column;
                gap: 10px;
            }

            .header-stats {
                gap: 16px;
            }

            .event-card {
                flex-direction: column;
            }

            .event-card-image {
                width: 100%;
                min-height: 80px;
                border-right: none;
                border-bottom: 1px solid var(--gray-200);
            }

            .event-detail {
                flex-direction: column;
                gap: 2px;
            }

            .event-detail-label {
                min-width: auto;
            }

            .calendar-day {
                min-height: 60px;
                padding: 4px;
            }

            .calendar-day-header {
                padding: 6px 2px;
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="header">
        <div class="header-brand">
            <h1>üîç Event Finder</h1>
        </div>
        <div class="header-stats">
            <div class="header-stat" onclick="showOrganizations()">
                <div class="header-stat-value" id="totalOrgs">-</div>
                <div class="header-stat-label">Organizations</div>
            </div>
            <div class="header-stat" onclick="showUpcoming()">
                <div class="header-stat-value" id="upcomingEvents">-</div>
                <div class="header-stat-label">Upcoming</div>
            </div>
        </div>
    </header>

    <!-- ============================================
         MAIN LAYOUT
         ============================================ -->
    <div class="main-layout">
        <!-- LEFT SIDEBAR -->
        <aside class="sidebar">
            <!-- Location Filter -->
            <div class="filter-section">
                <div class="filter-section-title">üìç Location</div>
                <div class="location-row">
                    <span>Within</span>
                    <select class="radius-select" id="radiusSelect">
                        <option value="25">25</option>
                        <option value="100">100</option>
                        <option value="us">US</option>
                        <option value="worldwide" selected>All</option>
                    </select>
                    <span>miles of</span>
                    <input type="text" class="zip-input" id="zipInput" placeholder="zip code">
                </div>
                <label class="use-location">
                    <input type="checkbox" id="useMyLocation">
                    Use my location
                </label>
            </div>

            <!-- Date Range -->
            <div class="filter-section">
                <div class="filter-section-title">üìÖ Date Range</div>
                <div class="date-row">
                    <label>Start:</label>
                    <input type="date" class="date-input" id="dateFrom">
                </div>
                <div class="date-row">
                    <label>End:</label>
                    <input type="date" class="date-input" id="dateTo">
                </div>
            </div>

            <!-- More Filters Button -->
            <div class="filter-section">
                <button class="more-filters-btn" id="moreFiltersBtn" onclick="openFilterModal()">
                    <span>‚öôÔ∏è</span>
                    <span>More Filters</span>
                    <span class="filter-count-badge" id="filterCountBadge" style="display: none;">0</span>
                </button>
            </div>

            <!-- Active Filters -->
            <div class="active-filters-sidebar" id="activeFiltersSidebar" style="display: none;">
                <div id="activeFilterTags"></div>
                <button class="clear-filters-btn" onclick="resetFilters()">Clear All Filters</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- Search Box -->
            <div class="search-container">
                <div class="search-box">
                    <span class="search-box-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Search events by keyword...">
                </div>
            </div>

            <!-- Results Info -->
            <div class="results-info">
                <span class="results-count">Showing <strong id="showingCount">0</strong> events</span>
                <div class="view-toggle">
                    <button id="listViewBtn" class="active" onclick="setView('list')">üìã List</button>
                    <button id="calendarViewBtn" onclick="setView('calendar')">üìÖ Calendar</button>
                </div>
            </div>

            <!-- Events List -->
            <div class="events-list" id="eventsList">
                <!-- Event cards inserted here -->
            </div>

            <!-- Calendar View -->
            <div class="calendar-container" id="calendarContainer">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚óÄ Prev</button>
                        <button class="calendar-nav-btn" onclick="goToToday()">Today</button>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)">Next ‚ñ∂</button>
                    </div>
                    <div class="calendar-title" id="calendarTitle">December 2025</div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </main>
    </div>

    <!-- ============================================
         MORE FILTERS MODAL
         ============================================ -->
    <div class="modal-overlay" id="filterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è More Filters</h2>
                <button class="modal-close" onclick="closeFilterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Event Type -->
                <div class="modal-section">
                    <div class="modal-section-title">üéØ Event Type</div>
                    <div class="checkbox-grid" id="typeOptions">
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-virtual" value="Virtual">
                            <label for="type-virtual">üñ•Ô∏è Virtual</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-inperson" value="In-person">
                            <label for="type-inperson">üìç In-Person</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="type-hybrid" value="Hybrid">
                            <label for="type-hybrid">üîÑ Hybrid</label>
                        </div>
                    </div>
                </div>

                <!-- Organizations -->
                <div class="modal-section">
                    <div class="modal-section-title">üèõÔ∏è Organizations</div>
                    <div class="checkbox-grid" id="orgOptions">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Topics -->
                <div class="modal-section">
                    <div class="modal-section-title">üè∑Ô∏è Topics</div>
                    <div class="checkbox-grid" id="topicOptions">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Regions -->
                <div class="modal-section">
                    <div class="modal-section-title">üåç Regions</div>
                    <div class="checkbox-grid" id="regionOptions">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="resetModalFilters()">Reset</button>
                <button class="btn btn-primary" onclick="applyAndClose()">Apply Filters</button>
            </div>
        </div>
    </div>

    <!-- ============================================
         ORGANIZATIONS MODAL
         ============================================ -->
    <div class="modal-overlay" id="orgsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üèõÔ∏è Organizations</h2>
                <button class="modal-close" onclick="closeOrgsModal()">&times;</button>
            </div>
            <div class="modal-body" id="orgsModalBody">
                <!-- Organization list inserted here -->
            </div>
        </div>
    </div>

    <!-- ============================================
         JAVASCRIPT
         ============================================ -->
    <script>
        // ============================================================================
        // CONFIGURATION
        // ============================================================================
        
        const POCKETBASE_URL = 'https://event-discovery-backend-production.up.railway.app';
        
        // Topics sorted alphabetically
        const TOPICS = [
            { value: 'AI & Emerging Tech', label: 'ü§ñ AI & Emerging Tech', emoji: 'ü§ñ', class: 'ai-emerging-tech' },
            { value: 'Careers & Professional Development', label: 'üíº Careers', emoji: 'üíº', class: 'careers' },
            { value: 'Climate & Security', label: 'üåç Climate & Security', emoji: 'üåç', class: 'climate-security' },
            { value: 'Counterterrorism', label: 'üéØ Counterterrorism', emoji: 'üéØ', class: 'counterterrorism' },
            { value: 'Cybersecurity', label: 'üîí Cybersecurity', emoji: 'üîí', class: 'cybersecurity' },
            { value: 'Defense Policy', label: 'üõ°Ô∏è Defense Policy', emoji: 'üõ°Ô∏è', class: 'defense-policy' },
            { value: 'Diplomacy & Statecraft', label: 'ü§ù Diplomacy', emoji: 'ü§ù', class: 'diplomacy-statecraft' },
            { value: 'Economic Security', label: 'üí∞ Economic Security', emoji: 'üí∞', class: 'economic-security' },
            { value: 'Homeland Security', label: 'üè† Homeland Security', emoji: 'üè†', class: 'homeland-security' },
            { value: 'Intelligence', label: 'üïµÔ∏è Intelligence', emoji: 'üïµÔ∏è', class: 'intelligence' },
            { value: 'Military Operations', label: '‚öîÔ∏è Military Ops', emoji: '‚öîÔ∏è', class: 'military-operations' },
            { value: 'Nuclear/WMD', label: '‚ò¢Ô∏è Nuclear/WMD', emoji: '‚ò¢Ô∏è', class: 'nuclear-wmd' },
            { value: 'Space & Satellites', label: 'üõ∞Ô∏è Space', emoji: 'üõ∞Ô∏è', class: 'space-satellites' }
        ];

        // Regions sorted alphabetically
        const REGIONS = [
            { value: 'Africa', label: 'üåç Africa' },
            { value: 'Arctic', label: '‚ùÑÔ∏è Arctic' },
            { value: 'China', label: 'üá®üá≥ China' },
            { value: 'Domestic US', label: 'üá∫üá∏ Domestic US' },
            { value: 'Europe/NATO', label: 'üá™üá∫ Europe/NATO' },
            { value: 'Global/Multilateral', label: 'üåê Global' },
            { value: 'Indo-Pacific', label: 'üåè Indo-Pacific' },
            { value: 'Latin America', label: 'üåé Latin America' },
            { value: 'Middle East', label: 'üïå Middle East' },
            { value: 'Russia', label: 'üá∑üá∫ Russia' }
        ];

        // ============================================================================
        // STATE
        // ============================================================================
        
        let allEvents = [];
        let filteredEvents = [];
        let organizations = {};
        let orgsWithEvents = new Set();
        let selectedTopics = [];
        let selectedRegions = [];
        let selectedOrgs = [];
        let selectedTypes = [];
        let dateFrom = null;
        let dateTo = null;
        let currentView = 'list';
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // ============================================================================
        // INITIALIZATION
        // ============================================================================
        
        document.addEventListener('DOMContentLoaded', async () => {
            setDefaultDates();
            await loadOrganizations();
            await loadEvents();
            initializeFilterOptions();
            
            // Add event listeners
            document.getElementById('searchInput').addEventListener('input', debounce(applyFilters, 300));
            document.getElementById('dateFrom').addEventListener('change', applyFilters);
            document.getElementById('dateTo').addEventListener('change', applyFilters);
            document.getElementById('radiusSelect').addEventListener('change', applyFilters);
            document.getElementById('zipInput').addEventListener('input', debounce(applyFilters, 500));
        });

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function setDefaultDates() {
            const today = new Date();
            const oneYearLater = new Date();
            oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
            
            document.getElementById('dateFrom').value = today.toISOString().split('T')[0];
            document.getElementById('dateTo').value = oneYearLater.toISOString().split('T')[0];
            
            dateFrom = today;
            dateTo = oneYearLater;
        }

        function initializeFilterOptions() {
            // Topics
            const topicContainer = document.getElementById('topicOptions');
            topicContainer.innerHTML = TOPICS.map(t => `
                <div class="checkbox-item">
                    <input type="checkbox" id="topic-${t.value.replace(/[^a-z]/gi, '')}" value="${t.value}" onchange="updateTopicSelection()">
                    <label for="topic-${t.value.replace(/[^a-z]/gi, '')}">${t.label}</label>
                </div>
            `).join('');

            // Regions
            const regionContainer = document.getElementById('regionOptions');
            regionContainer.innerHTML = REGIONS.map(r => `
                <div class="checkbox-item">
                    <input type="checkbox" id="region-${r.value.replace(/[^a-z]/gi, '')}" value="${r.value}" onchange="updateRegionSelection()">
                    <label for="region-${r.value.replace(/[^a-z]/gi, '')}">${r.label}</label>
                </div>
            `).join('');
        }

        async function loadOrganizations() {
            try {
                const response = await fetch(`${POCKETBASE_URL}/api/collections/organizations/records?perPage=500`);
                const data = await response.json();
                
                if (data && data.items && Array.isArray(data.items)) {
                    data.items.forEach(org => {
                        organizations[org.id] = org;
                    });
                }
                
                document.getElementById('totalOrgs').textContent = Object.keys(organizations).length;
            } catch (error) {
                console.error('Error loading organizations:', error);
            }
        }

        async function loadEvents() {
            try {
                const response = await fetch(`${POCKETBASE_URL}/api/collections/events/records?perPage=500&sort=start_date`);
                const data = await response.json();
                
                allEvents = (data.items || []).map(event => ({
                    ...event,
                    startDate: event.start_date ? new Date(event.start_date) : null,
                    endDate: event.end_date ? new Date(event.end_date) : null
                }));

                // Track which orgs have events
                allEvents.forEach(e => {
                    if (e.organization) orgsWithEvents.add(e.organization);
                });

                // Populate org filter
                populateOrgFilter();
                
                // Count upcoming events
                const now = new Date();
                const upcoming = allEvents.filter(e => e.startDate && e.startDate >= now).length;
                document.getElementById('upcomingEvents').textContent = upcoming;
                
                applyFilters();
            } catch (error) {
                console.error('Error loading events:', error);
            }
        }

        function populateOrgFilter() {
            const orgContainer = document.getElementById('orgOptions');
            const orgsArray = Array.from(orgsWithEvents)
                .map(id => organizations[id])
                .filter(org => org)
                .sort((a, b) => a.name.localeCompare(b.name));

            orgContainer.innerHTML = orgsArray.map(org => `
                <div class="checkbox-item">
                    <input type="checkbox" id="org-${org.id}" value="${org.id}" onchange="updateOrgSelection()">
                    <label for="org-${org.id}">${org.name}</label>
                </div>
            `).join('');
        }

        // ============================================================================
        // FILTER SELECTION HANDLERS
        // ============================================================================

        function updateTopicSelection() {
            selectedTopics = [];
            document.querySelectorAll('#topicOptions input[type="checkbox"]:checked').forEach(cb => {
                selectedTopics.push(cb.value);
            });
        }

        function updateRegionSelection() {
            selectedRegions = [];
            document.querySelectorAll('#regionOptions input[type="checkbox"]:checked').forEach(cb => {
                selectedRegions.push(cb.value);
            });
        }

        function updateOrgSelection() {
            selectedOrgs = [];
            document.querySelectorAll('#orgOptions input[type="checkbox"]:checked').forEach(cb => {
                selectedOrgs.push(cb.value);
            });
        }

        function updateTypeSelection() {
            selectedTypes = [];
            document.querySelectorAll('#typeOptions input[type="checkbox"]:checked').forEach(cb => {
                selectedTypes.push(cb.value);
            });
        }

        // ============================================================================
        // FILTERING
        // ============================================================================
        
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Get date values
            const dateFromValue = document.getElementById('dateFrom').value;
            const dateToValue = document.getElementById('dateTo').value;
            dateFrom = dateFromValue ? new Date(dateFromValue) : null;
            dateTo = dateToValue ? new Date(dateToValue + 'T23:59:59') : null;

            // Update type selection
            updateTypeSelection();

            filteredEvents = allEvents.filter(event => {
                // Search filter
                if (searchTerm) {
                    const titleMatch = (event.title || '').toLowerCase().includes(searchTerm);
                    const descMatch = (event.description || '').toLowerCase().includes(searchTerm);
                    const locMatch = (event.location || '').toLowerCase().includes(searchTerm);
                    if (!titleMatch && !descMatch && !locMatch) return false;
                }

                // Date range filter
                if (dateFrom && event.startDate && event.startDate < dateFrom) return false;
                if (dateTo && event.startDate && event.startDate > dateTo) return false;

                // Topic filter
                if (selectedTopics.length > 0) {
                    const eventTopics = event.topics || [];
                    const hasMatchingTopic = selectedTopics.some(t => eventTopics.includes(t));
                    if (!hasMatchingTopic) return false;
                }

                // Region filter
                if (selectedRegions.length > 0) {
                    const eventRegions = event.regions || [];
                    const hasMatchingRegion = selectedRegions.some(r => eventRegions.includes(r));
                    if (!hasMatchingRegion) return false;
                }

                // Organization filter
                if (selectedOrgs.length > 0) {
                    if (!selectedOrgs.includes(event.organization)) return false;
                }

                // Type filter
                if (selectedTypes.length > 0) {
                    const eventType = (event.event_type || '').toLowerCase();
                    const hasMatchingType = selectedTypes.some(t => eventType.includes(t.toLowerCase()));
                    if (!hasMatchingType) return false;
                }

                return true;
            });

            document.getElementById('showingCount').textContent = filteredEvents.length;
            
            renderEvents();
            updateActiveFiltersDisplay();
            updateFilterBadge();
            
            if (currentView === 'calendar') {
                renderCalendar();
            }
        }

        function updateActiveFiltersDisplay() {
            const container = document.getElementById('activeFilterTags');
            const sidebar = document.getElementById('activeFiltersSidebar');
            const tags = [];

            selectedTopics.forEach(t => {
                const topic = TOPICS.find(tp => tp.value === t);
                tags.push(`<span class="active-filter-tag">${topic?.label || t}<button onclick="removeFilter('topic', '${t}')">&times;</button></span>`);
            });

            selectedRegions.forEach(r => {
                const region = REGIONS.find(rg => rg.value === r);
                tags.push(`<span class="active-filter-tag">${region?.label || r}<button onclick="removeFilter('region', '${r}')">&times;</button></span>`);
            });

            selectedOrgs.forEach(o => {
                const org = organizations[o];
                tags.push(`<span class="active-filter-tag">${org?.name || o}<button onclick="removeFilter('org', '${o}')">&times;</button></span>`);
            });

            selectedTypes.forEach(t => {
                tags.push(`<span class="active-filter-tag">${t}<button onclick="removeFilter('type', '${t}')">&times;</button></span>`);
            });

            if (tags.length > 0) {
                container.innerHTML = tags.join('');
                sidebar.style.display = 'block';
            } else {
                sidebar.style.display = 'none';
            }
        }

        function updateFilterBadge() {
            const count = selectedTopics.length + selectedRegions.length + selectedOrgs.length + selectedTypes.length;
            const badge = document.getElementById('filterCountBadge');
            const btn = document.getElementById('moreFiltersBtn');
            
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'inline';
                btn.classList.add('has-filters');
            } else {
                badge.style.display = 'none';
                btn.classList.remove('has-filters');
            }
        }

        function removeFilter(type, value) {
            if (type === 'topic') {
                selectedTopics = selectedTopics.filter(t => t !== value);
                const cb = document.querySelector(`#topicOptions input[value="${value}"]`);
                if (cb) cb.checked = false;
            } else if (type === 'region') {
                selectedRegions = selectedRegions.filter(r => r !== value);
                const cb = document.querySelector(`#regionOptions input[value="${value}"]`);
                if (cb) cb.checked = false;
            } else if (type === 'org') {
                selectedOrgs = selectedOrgs.filter(o => o !== value);
                const cb = document.querySelector(`#orgOptions input[value="${value}"]`);
                if (cb) cb.checked = false;
            } else if (type === 'type') {
                selectedTypes = selectedTypes.filter(t => t !== value);
                const cb = document.querySelector(`#typeOptions input[value="${value}"]`);
                if (cb) cb.checked = false;
            }
            applyFilters();
        }

        function resetFilters() {
            selectedTopics = [];
            selectedRegions = [];
            selectedOrgs = [];
            selectedTypes = [];
            
            document.querySelectorAll('#filterModal input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('searchInput').value = '';
            document.getElementById('zipInput').value = '';
            document.getElementById('radiusSelect').value = 'worldwide';
            
            setDefaultDates();
            applyFilters();
        }

        function resetModalFilters() {
            selectedTopics = [];
            selectedRegions = [];
            selectedOrgs = [];
            selectedTypes = [];
            document.querySelectorAll('#filterModal input[type="checkbox"]').forEach(cb => cb.checked = false);
        }

        // ============================================================================
        // RENDERING
        // ============================================================================
        
        function renderEvents() {
            const container = document.getElementById('eventsList');
            
            if (filteredEvents.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <h3>No events found</h3>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredEvents.map(event => {
                const topicInfo = getTopicInfo(event.topics);
                const org = organizations[event.organization];
                const orgName = org?.name || 'Unknown Organization';
                const orgWebsite = org?.website || '#';
                
                // Build date display
                let dateDisplay = '';
                const startDate = event.start_date ? new Date(event.start_date) : null;
                const endDate = event.end_date ? new Date(event.end_date) : null;
                
                if (startDate && endDate && startDate.getTime() !== endDate.getTime()) {
                    dateDisplay = `${formatDateShort(startDate)} to ${formatDateShort(endDate)}`;
                } else if (startDate) {
                    dateDisplay = formatDateShort(startDate);
                    if (event.start_time) {
                        dateDisplay += ` ‚Ä¢ ${event.start_time}`;
                    }
                } else {
                    dateDisplay = 'Date TBD';
                }
                
                // Build location display
                let locationDisplay = '';
                const eventType = (event.event_type || '').toLowerCase();
                const location = event.location || '';
                
                if (eventType === 'virtual') {
                    locationDisplay = 'Virtual Event';
                } else if (eventType === 'hybrid') {
                    locationDisplay = location ? `Hybrid: ${escapeHtml(location)}` : 'Hybrid';
                } else {
                    locationDisplay = location ? escapeHtml(location) : 'Location TBD';
                }

                return `
                    <div class="event-card">
                        <div class="event-card-image ${topicInfo.class}">
                            <span>${topicInfo.emoji}</span>
                        </div>
                        <div class="event-card-content">
                            <div class="event-title">${escapeHtml(event.title)}</div>
                            <div class="event-detail">
                                <span class="event-detail-label">Dates:</span>
                                <span class="event-detail-value">${dateDisplay}</span>
                            </div>
                            <div class="event-detail">
                                <span class="event-detail-label">Organization:</span>
                                <span class="event-detail-value"><a href="${orgWebsite}" target="_blank">${escapeHtml(orgName)}</a></span>
                            </div>
                            <div class="event-detail">
                                <span class="event-detail-label">Location:</span>
                                <span class="event-detail-value">${locationDisplay}</span>
                            </div>
                            ${event.url ? `<a href="${event.url}" target="_blank" class="event-register-link">Register</a>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatDateShort(date) {
            if (!date) return '';
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        function getTopicInfo(topics) {
            if (!topics || topics.length === 0) {
                return { emoji: 'üìÖ', class: 'default' };
            }
            const topic = TOPICS.find(t => t.value === topics[0]);
            return topic ? { emoji: topic.emoji, class: topic.class } : { emoji: 'üìÖ', class: 'default' };
        }

        // ============================================================================
        // VIEW TOGGLE
        // ============================================================================
        
        function setView(view) {
            currentView = view;
            const listBtn = document.getElementById('listViewBtn');
            const calBtn = document.getElementById('calendarViewBtn');
            const listView = document.getElementById('eventsList');
            const calView = document.getElementById('calendarContainer');

            if (view === 'list') {
                listBtn.classList.add('active');
                calBtn.classList.remove('active');
                listView.classList.remove('hidden');
                calView.classList.remove('active');
            } else {
                listBtn.classList.remove('active');
                calBtn.classList.add('active');
                listView.classList.add('hidden');
                calView.classList.add('active');
                renderCalendar();
            }
        }

        // ============================================================================
        // CALENDAR VIEW
        // ============================================================================
        
        function renderCalendar() {
            const title = document.getElementById('calendarTitle');
            const grid = document.getElementById('calendarGrid');
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            title.textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDayOfWeek = firstDay.getDay();
            const totalDays = lastDay.getDate();

            // Get events for this month
            const monthEvents = filteredEvents.filter(e => {
                if (!e.startDate) return false;
                return e.startDate.getMonth() === currentMonth && 
                       e.startDate.getFullYear() === currentYear;
            });

            // Group events by date
            const eventsByDate = {};
            monthEvents.forEach(e => {
                const dateKey = e.startDate.getDate();
                if (!eventsByDate[dateKey]) eventsByDate[dateKey] = [];
                eventsByDate[dateKey].push(e);
            });

            let html = `
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            `;

            // Previous month days
            const prevMonth = new Date(currentYear, currentMonth, 0);
            for (let i = startDayOfWeek - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month">
                    <div class="calendar-date">${prevMonth.getDate() - i}</div>
                </div>`;
            }

            // Current month days
            const today = new Date();
            for (let day = 1; day <= totalDays; day++) {
                const isToday = day === today.getDate() && 
                               currentMonth === today.getMonth() && 
                               currentYear === today.getFullYear();
                
                const dayEvents = eventsByDate[day] || [];
                const displayEvents = dayEvents.slice(0, 2);
                const moreCount = dayEvents.length - 2;

                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}">
                        <div class="calendar-date">${day}</div>
                        ${displayEvents.map(e => 
                            `<div class="calendar-event" title="${escapeHtml(e.title)}">${escapeHtml(e.title.substring(0, 15))}${e.title.length > 15 ? '...' : ''}</div>`
                        ).join('')}
                        ${moreCount > 0 ? `<div class="calendar-more">+${moreCount} more</div>` : ''}
                    </div>
                `;
            }

            // Next month days
            const remainingCells = 42 - (startDayOfWeek + totalDays);
            for (let day = 1; day <= remainingCells && remainingCells < 7; day++) {
                html += `<div class="calendar-day other-month">
                    <div class="calendar-date">${day}</div>
                </div>`;
            }

            grid.innerHTML = html;
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        }

        function goToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            renderCalendar();
        }

        // ============================================================================
        // MODALS
        // ============================================================================
        
        function openFilterModal() {
            document.getElementById('filterModal').classList.add('active');
        }

        function closeFilterModal() {
            document.getElementById('filterModal').classList.remove('active');
        }

        function applyAndClose() {
            applyFilters();
            closeFilterModal();
        }

        function showOrganizations() {
            const container = document.getElementById('orgsModalBody');
            const sortedOrgs = Object.values(organizations).sort((a, b) => a.name.localeCompare(b.name));
            
            // Count events per org
            const eventCounts = {};
            allEvents.forEach(e => {
                eventCounts[e.organization] = (eventCounts[e.organization] || 0) + 1;
            });

            container.innerHTML = sortedOrgs.map(org => `
                <div class="org-item">
                    <div class="org-icon">üèõÔ∏è</div>
                    <div class="org-info">
                        <div class="org-name"><a href="${org.website || '#'}" target="_blank">${escapeHtml(org.name)}</a></div>
                        <div class="org-type">${org.org_type || 'Organization'}</div>
                    </div>
                    <div class="org-event-count">${eventCounts[org.id] || 0} events</div>
                </div>
            `).join('');

            document.getElementById('orgsModal').classList.add('active');
        }

        function closeOrgsModal() {
            document.getElementById('orgsModal').classList.remove('active');
        }

        function showUpcoming() {
            resetFilters();
        }

        // ============================================================================
        // UTILITIES
        // ============================================================================
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Close modals on escape or backdrop click
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeFilterModal();
                closeOrgsModal();
            }
        });

        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
